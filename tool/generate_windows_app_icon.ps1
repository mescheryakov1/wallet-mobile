[CmdletBinding()]
param(
    [string]$IconPath
)

Set-StrictMode -Version Latest
$ErrorActionPreference = "Stop"

if (-not $IconPath) {
    $repoRoot = (Resolve-Path (Join-Path -Path $PSScriptRoot -ChildPath "..")).Path
    $IconPath = Join-Path -Path $repoRoot -ChildPath "windows/runner/resources/app_icon.ico"
}

$iconDirectory = Split-Path -Path $IconPath -Parent
if (-not (Test-Path $iconDirectory)) {
    New-Item -ItemType Directory -Force -Path $iconDirectory | Out-Null
}

$iconBase64 = @'
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
'@

$normalizedBase64 = ($iconBase64 -replace '\s', '')

$shouldWrite = $true
if (Test-Path $IconPath) {
    try {
        $existingBytes = [System.IO.File]::ReadAllBytes($IconPath)
        $existingBase64 = [Convert]::ToBase64String($existingBytes)
        if ($existingBase64 -eq $normalizedBase64) {
            Write-Verbose "Existing icon matches requested content; skipping regeneration."
            $shouldWrite = $false
        }
    } catch {
        Write-Warning "Failed to compare existing icon contents. Regenerating icon."
    }
}

if ($shouldWrite) {
    $iconBytes = [Convert]::FromBase64String($normalizedBase64)
    [System.IO.File]::WriteAllBytes($IconPath, $iconBytes)
    Write-Verbose "Generated Windows application icon at '$IconPath'."
}
